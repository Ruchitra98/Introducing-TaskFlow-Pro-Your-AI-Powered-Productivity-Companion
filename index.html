<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskFlow Pro | AI-Powered Task Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      /* Color System */
      --primary-50: #eef2ff;
      --primary-100: #e0e7ff;
      --primary-200: #c7d2fe;
      --primary-300: #a5b4fc;
      --primary-400: #818cf8;
      --primary-500: #6366f1;
      --primary-600: #4f46e5;
      --primary-700: #4338ca;
      --primary-800: #3730a3;
      --primary-900: #312e81;
      
      --secondary-50: #f0fdfa;
      --secondary-100: #ccfbf1;
      --secondary-200: #99f6e4;
      --secondary-300: #5eead4;
      --secondary-400: #2dd4bf;
      --secondary-500: #14b8a6;
      --secondary-600: #0d9488;
      --secondary-700: #0f766e;
      --secondary-800: #115e59;
      --secondary-900: #134e4a;
      
      /* Semantic Colors */
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
      
      /* Grayscale */
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      
      /* Theme Variables - Light Mode */
      --bg-primary: var(--gray-50);
      --bg-secondary: var(--gray-100);
      --bg-card: white;
      --bg-sidebar: white;
      --bg-input: white;
      --text-primary: var(--gray-900);
      --text-secondary: var(--gray-600);
      --border-color: var(--gray-200);
      
      /* Priority Colors */
      --priority-critical: #dc2626;
      --priority-high: #ea580c;
      --priority-medium: #d97706;
      --priority-low: #65a30d;
      --overdue-color: #ef4444;
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      
      /* Typography */
      --text-xs: 0.75rem;
      --text-sm: 0.875rem;
      --text-base: 1rem;
      --text-lg: 1.125rem;
      --text-xl: 1.25rem;
      --text-2xl: 1.5rem;
      --text-3xl: 1.875rem;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
      
      /* Border Radius */
      --radius-sm: 0.25rem;
      --radius: 0.5rem;
      --radius-md: 0.75rem;
      --radius-lg: 1rem;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition: 300ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Dark Theme */
    [data-theme="dark"] {
      --bg-primary: var(--gray-900);
      --bg-secondary: var(--gray-800);
      --bg-card: var(--gray-800);
      --bg-sidebar: var(--gray-800);
      --bg-input: var(--gray-700);
      --text-primary: white;
      --text-secondary: var(--gray-300);
      --border-color: var(--gray-700);
      
      --priority-critical: #f87171;
      --priority-high: #fb923c;
      --priority-medium: #fbbf24;
      --priority-low: #86efac;
      --overdue-color: #fca5a5;
      
      --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
    }

    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      color: var(--text-primary);
      background-color: var(--bg-primary);
      line-height: 1.6;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      transition: background-color var(--transition), color var(--transition);
    }

    /* Typography */
    h1, h2, h3, h4 {
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
    }

    h1 { font-size: var(--text-3xl); }
    h2 { font-size: var(--text-2xl); }
    h3 { font-size: var(--text-xl); }
    h4 { font-size: var(--text-lg); }

    /* Layout Components */
    .app-container {
      display: grid;
      grid-template-columns: 240px 1fr;
      min-height: 100vh;
    }

    .sidebar {
      background-color: var(--bg-sidebar);
      border-right: 1px solid var(--border-color);
      padding: var(--space-lg);
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      transition: all var(--transition);
    }

    .main-content {
      padding: var(--space-lg);
      background-color: var(--bg-primary);
      position: relative;
      overflow: hidden;
    }

    /* Content Sections */
    .content-section {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: var(--space-lg);
      opacity: 0;
      transform: translateX(20px);
      transition: all var(--transition);
      pointer-events: none;
    }

    .content-section.active {
      opacity: 1;
      transform: translateX(0);
      pointer-events: all;
      transition-delay: 0.1s;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-xl);
    }

    /* Navigation */
    .logo {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .logo-icon {
      color: var(--primary-600);
      font-size: var(--text-2xl);
    }

    .logo-text {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      font-size: var(--text-xl);
      color: var(--primary-600);
    }

    .nav-menu {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
      margin-bottom: var(--space-xl);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius);
      color: var(--text-secondary);
      text-decoration: none;
      transition: all var(--transition-fast);
    }

    .nav-item:hover {
      background-color: var(--bg-secondary);
      color: var(--primary-600);
    }

    .nav-item.active {
      background-color: rgba(99, 102, 241, 0.1);
      color: var(--primary-600);
      font-weight: 500;
    }

    .nav-item i {
      width: 20px;
      text-align: center;
    }

    .team-section {
      margin-top: var(--space-xl);
    }

    .team-heading {
      font-size: var(--text-xs);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gray-500);
      margin-bottom: var(--space-md);
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      transition: all var(--transition);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      font-size: var(--text-sm);
    }

    .btn-primary {
      background-color: var(--primary-600);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-700);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background-color: var(--bg-card);
      color: var(--primary-600);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background-color: var(--bg-secondary);
      box-shadow: var(--shadow-sm);
    }

    .btn-icon {
      width: 2.25rem;
      height: 2.25rem;
      padding: 0;
      border-radius: var(--radius-full);
    }

    /* Task List */
    .task-list-container {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      transition: all var(--transition);
    }

    .task-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
    }

    .task-list-title {
      font-size: var(--text-lg);
      font-weight: 600;
    }

    .task-list-filters {
      display: flex;
      gap: var(--space-xs);
    }

    .filter-btn {
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      background-color: var(--bg-secondary);
      color: var(--text-secondary);
      border: none;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .filter-btn.active {
      background-color: var(--primary-600);
      color: white;
    }

    .task-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .task-item {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: var(--space-md);
      display: flex;
      align-items: flex-start;
      gap: var(--space-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      position: relative;
    }

    .task-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .task-item.completed {
      background-color: rgba(100, 108, 255, 0.07);
      border-left: 3px solid var(--secondary-500);
    }

    .task-item.overdue {
      border-left: 3px solid var(--overdue-color);
    }

    .task-checkbox {
      margin-top: 2px;
      accent-color: var(--secondary-500);
    }

    .task-content {
      flex: 1;
      min-width: 0;
    }

    .task-title {
      font-weight: 500;
      margin-bottom: var(--space-xs);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .task-title.completed {
      text-decoration: line-through;
      color: var(--gray-500);
    }

    .task-description {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      margin-bottom: var(--space-sm);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .task-meta {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      font-size: var(--text-xs);
      color: var(--gray-500);
    }

    .task-priority {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: 500;
    }

    .priority-critical {
      background-color: rgba(220, 38, 38, 0.1);
      color: var(--priority-critical);
    }

    .priority-high {
      background-color: rgba(234, 88, 12, 0.1);
      color: var(--priority-high);
    }

    .priority-medium {
      background-color: rgba(217, 119, 6, 0.1);
      color: var(--priority-medium);
    }

    .priority-low {
      background-color: rgba(101, 163, 13, 0.1);
      color: var(--priority-low);
    }

    .task-due-date {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .task-due-date.overdue {
      color: var(--overdue-color);
      font-weight: 500;
    }

    .task-actions {
      display: flex;
      gap: var(--space-xs);
    }

    /* Dashboard Layout */
    .dashboard {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: var(--space-lg);
    }

    /* Stats Panel */
    .stats-panel {
      display: flex;
      flex-direction: column;
      gap: var(--space-lg);
    }

    /* Progress Chart */
    .progress-container {
      height: 200px;
    }

    /* Priority Stats */
    .priority-stats {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .stat-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .stat-label {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-size: var(--text-sm);
    }

    .priority-dot {
      width: 10px;
      height: 10px;
      border-radius: var(--radius-full);
    }

    .priority-dot.critical {
      background-color: var(--priority-critical);
    }

    .priority-dot.high {
      background-color: var(--priority-high);
    }

    .priority-dot.medium {
      background-color: var(--priority-medium);
    }

    .priority-dot.low {
      background-color: var(--priority-low);
    }

    .stat-value {
      font-weight: 600;
    }

    /* Activity Feed */
    .activity-item {
      display: flex;
      gap: var(--space-md);
      padding: var(--space-sm) 0;
      border-bottom: 1px solid var(--border-color);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background-color: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-600);
      flex-shrink: 0;
    }

    .activity-content {
      font-size: var(--text-sm);
    }

    .activity-time {
      font-size: var(--text-xs);
      color: var(--gray-500);
      margin-top: var(--space-xs);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: var(--space-xl) var(--space-md);
    }

    .empty-icon {
      font-size: 48px;
      color: var(--gray-400);
      margin-bottom: var(--space-md);
    }

    .empty-title {
      font-size: var(--text-lg);
      font-weight: 500;
      margin-bottom: var(--space-xs);
    }

    .empty-description {
      color: var(--text-secondary);
      margin-bottom: var(--space-md);
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: var(--bg-card);
      border-radius: var(--radius-md);
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(20px);
      transition: var(--transition);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-color);
    }

    .modal.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      padding: var(--space-md) var(--space-lg);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: var(--text-lg);
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: var(--text-xl);
      color: var(--gray-500);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .modal-close:hover {
      color: var(--text-primary);
    }

    .modal-body {
      padding: var(--space-lg);
    }

    .form-group {
      margin-bottom: var(--space-lg);
    }

    .form-label {
      display: block;
      margin-bottom: var(--space-xs);
      font-size: var(--text-sm);
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: var(--space-sm) var(--space-md);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      font-family: 'Inter', sans-serif;
      transition: var(--transition-fast);
      background-color: var(--bg-input);
      color: var(--text-primary);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }

    .radio-group {
      display: flex;
      gap: var(--space-xs);
      margin-top: var(--space-xs);
    }

    .radio-option {
      flex: 1;
    }

    .radio-input {
      display: none;
    }

    .radio-label {
      display: block;
      padding: var(--space-sm);
      text-align: center;
      border-radius: var(--radius);
      cursor: pointer;
      transition: var(--transition-fast);
      font-size: var(--text-sm);
      background-color: var(--bg-secondary);
      color: var(--text-primary);
    }

    .radio-input:checked + .radio-label {
      background-color: var(--primary-600);
      color: white;
    }

    .modal-footer {
      padding: var(--space-md) var(--space-lg);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: var(--space-md);
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: var(--space-lg);
      right: var(--space-lg);
      background-color: var(--text-primary);
      color: white;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: var(--space-md);
      z-index: 1100;
      transform: translateY(100px);
      opacity: 0;
      transition: var(--transition);
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success {
      background-color: var(--success);
    }

    .toast.error {
      background-color: var(--danger);
    }

    .toast.warning {
      background-color: var(--warning);
    }

    .toast-icon {
      font-size: var(--text-lg);
    }

    .toast-message {
      font-size: var(--text-sm);
    }

    /* Calendar View */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
    }

    .calendar-nav {
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }

    .calendar-title {
      font-family: 'Poppins', sans-serif;
      font-size: var(--text-xl);
      font-weight: 600;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: var(--space-xs);
    }

    .calendar-day-header {
      text-align: center;
      font-weight: 600;
      padding: var(--space-sm);
      color: var(--text-secondary);
    }

    .calendar-day {
      background-color: var(--bg-card);
      border-radius: var(--radius);
      padding: var(--space-sm);
      min-height: 100px;
      border: 1px solid var(--border-color);
    }

    .calendar-day.empty {
      background-color: var(--bg-secondary);
      border: none;
    }

    .calendar-day-number {
      font-weight: 600;
      margin-bottom: var(--space-xs);
    }

    .calendar-event {
      background-color: rgba(99, 102, 241, 0.1);
      border-left: 3px solid var(--primary-600);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      font-size: var(--text-xs);
      margin-bottom: var(--space-xs);
      cursor: pointer;
    }

    .calendar-day.today {
      background-color: rgba(99, 102, 241, 0.05);
      border: 1px solid var(--primary-600);
    }

    .calendar-days-container {
      display: contents;
    }

    /* Reports View */
    .reports-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--space-lg);
    }

    .report-card {
      background-color: var(--bg-card);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }

    .report-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }

    .report-card-title {
      font-weight: 600;
    }

    .report-card-value {
      font-size: var(--text-2xl);
      font-weight: 700;
      margin-bottom: var(--space-xs);
    }

    .report-card-description {
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }

    /* Settings View */
    .settings-section {
      background-color: var(--bg-card);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      margin-bottom: var(--space-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }

    .settings-section-title {
      font-size: var(--text-lg);
      font-weight: 600;
      margin-bottom: var(--space-md);
      padding-bottom: var(--space-xs);
      border-bottom: 1px solid var(--border-color);
    }

    .settings-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) 0;
      border-bottom: 1px solid var(--border-color);
    }

    .settings-item:last-child {
      border-bottom: none;
    }

    .settings-item-label {
      font-weight: 500;
    }

    .settings-item-description {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      margin-top: var(--space-xs);
    }

    /* Team Task Badge */
    .team-badge {
      display: inline-block;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: 500;
      background-color: rgba(99, 102, 241, 0.1);
      color: var(--primary-600);
      margin-left: var(--space-xs);
    }

    /* Focus Mode */
    .focus-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.9);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      color: white;
    }

    .focus-container.active {
      display: flex;
    }

    .focus-timer {
      font-size: 5rem;
      font-weight: bold;
      margin: 2rem 0;
      font-family: monospace;
    }

    .focus-task {
      font-size: 1.5rem;
      max-width: 80%;
      text-align: center;
      margin-bottom: 2rem;
    }

    .focus-actions {
      display: flex;
      gap: 1rem;
    }

    /* AI Assistant */
    .ai-assistant {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 350px;
      background-color: var(--bg-card);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-color);
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: var(--transition);
      display: none;
    }

    .ai-assistant.active {
      transform: translateY(0);
      opacity: 1;
      display: block;
    }

    .ai-header {
      padding: var(--space-md) var(--space-lg);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ai-header h3 {
      font-size: var(--text-lg);
      font-weight: 600;
      margin: 0;
    }

    .ai-close {
      background: none;
      border: none;
      font-size: var(--text-lg);
      color: var(--gray-500);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .ai-close:hover {
      color: var(--text-primary);
    }

    .ai-messages {
      padding: var(--space-lg);
      max-height: 400px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .ai-message {
      margin-bottom: var(--space-md);
      padding: var(--space-sm);
      border-radius: var(--radius);
      font-size: var(--text-sm);
      max-width: 80%;
    }

    .ai-message.ai {
      background-color: var(--bg-secondary);
      align-self: flex-start;
      margin-right: auto;
    }

    .ai-message.user {
      background-color: var(--primary-100);
      color: var(--primary-800);
      align-self: flex-end;
      margin-left: auto;
    }

    .ai-message-content {
      word-wrap: break-word;
    }

    .ai-message-time {
      font-size: var(--text-xs);
      color: var(--text-secondary);
      margin-top: var(--space-xs);
      text-align: right;
    }

    .ai-input-container {
      display: flex;
      padding: var(--space-md);
      border-top: 1px solid var(--border-color);
    }

    .ai-input {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      font-family: 'Inter', sans-serif;
      transition: var(--transition-fast);
      background-color: var(--bg-input);
      color: var(--text-primary);
    }

    .ai-input:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .ai-send-btn {
      width: 40px;
      height: 40px;
      margin-left: var(--space-sm);
      border-radius: var(--radius-full);
      background-color: var(--primary-600);
      color: white;
      border: none;
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ai-send-btn:hover {
      background-color: var(--primary-700);
    }

    .ai-suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
      margin-top: var(--space-md);
    }

    .ai-suggestion {
      background-color: var(--bg-secondary);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius);
      font-size: var(--text-xs);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .ai-suggestion:hover {
      background-color: var(--primary-100);
    }

    .ai-typing {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-sm);
      background-color: var(--bg-secondary);
      border-radius: var(--radius);
      margin-bottom: var(--space-md);
      align-self: flex-start;
      margin-right: auto;
      max-width: 80%;
    }

    .ai-typing-dot {
      width: 8px;
      height: 8px;
      background-color: var(--text-secondary);
      border-radius: 50%;
      animation: aiTyping 1.4s infinite ease-in-out;
    }

    .ai-typing-dot:nth-child(1) {
      animation-delay: 0s;
    }

    .ai-typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .ai-typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes aiTyping {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .app-container {
        grid-template-columns: 1fr;
      }

      .sidebar {
        display: none;
      }

      .dashboard {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        padding: var(--space-md) var(--space-sm);
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-md);
      }

      .header-actions {
        width: 100%;
        justify-content: space-between;
      }

      .task-list-filters {
        overflow-x: auto;
        padding-bottom: var(--space-xs);
      }

      .content-section {
        padding: var(--space-md) var(--space-sm);
      }

      .ai-assistant {
        width: 90%;
        right: 5%;
        bottom: 10px;
      }
    }

    /* Toggle Switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--gray-300);
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--primary-600);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <i class="fas fa-tasks logo-icon"></i>
        <span class="logo-text">TaskFlow Pro</span>
      </div>

      <nav class="nav-menu">
        <a href="#" class="nav-item active" data-section="dashboard">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
        <a href="#" class="nav-item" data-section="tasks">
          <i class="fas fa-inbox"></i>
          <span>My Tasks</span>
        </a>
        <a href="#" class="nav-item" data-section="calendar">
          <i class="fas fa-calendar-alt"></i>
          <span>Calendar</span>
        </a>
        <a href="#" class="nav-item" data-section="projects">
          <i class="fas fa-folder"></i>
          <span>Projects</span>
        </a>
        <a href="#" class="nav-item" data-section="reports">
          <i class="fas fa-chart-pie"></i>
          <span>Reports</span>
        </a>
        <a href="#" class="nav-item" data-section="settings">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </a>
      </nav>

      <div class="team-section">
        <div class="team-heading">My Teams</div>
        <nav class="nav-menu">
          <a href="#" class="nav-item active" data-team="development">
            <i class="fas fa-users"></i>
            <span>Development</span>
          </a>
          <a href="#" class="nav-item" data-team="marketing">
            <i class="fas fa-users"></i>
            <span>Marketing</span>
          </a>
          <a href="#" class="nav-item" data-team="design">
            <i class="fas fa-users"></i>
            <span>Design</span>
          </a>
        </nav>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard Section -->
      <section id="dashboard-section" class="content-section active">
        <div class="header">
          <h1 class="header-title">Development Team Dashboard</h1>
          <div class="header-actions">
            <button class="btn btn-secondary">
              <i class="fas fa-filter"></i>
              <span>Filters</span>
            </button>
            <button id="themeToggle" class="btn btn-secondary">
              <i class="fas fa-moon"></i>
              <span>Dark Mode</span>
            </button>
            <button id="addTaskBtn" class="btn btn-primary">
              <i class="fas fa-plus"></i>
              <span>New Task</span>
            </button>
            <button id="aiToggle" class="btn btn-primary">
              <i class="fas fa-robot"></i>
              <span>AI Assistant</span>
            </button>
          </div>
        </div>

        <div class="dashboard">
          <!-- Task List -->
          <div class="task-list-container">
            <div class="task-list-header">
              <h2 class="task-list-title">Team Tasks</h2>
              <div class="task-list-filters">
                <button class="filter-btn active">All</button>
                <button class="filter-btn">Active</button>
                <button class="filter-btn">Completed</button>
                <button class="filter-btn">Overdue</button>
              </div>
            </div>

            <div id="taskList" class="task-list">
              <!-- Tasks will be loaded here -->
              <div class="empty-state">
                <i class="fas fa-clipboard-list empty-icon"></i>
                <h3 class="empty-title">No tasks found</h3>
                <p class="empty-description">Create your first task to get started with TaskFlow Pro</p>
                <button id="emptyStateAddBtn" class="btn btn-primary">
                  <i class="fas fa-plus"></i>
                  <span>Create Task</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Stats Panel -->
          <div class="stats-panel">
            <!-- Progress Card -->
            <div class="card">
              <div class="card-header">
                <h3 class="stats-title">Team Progress</h3>
                <button class="btn btn-icon btn-secondary">
                  <i class="fas fa-ellipsis-h"></i>
                </button>
              </div>
              <div class="progress-container">
                <canvas id="progressChart"></canvas>
              </div>
            </div>

            <!-- Priority Stats -->
            <div class="card">
              <div class="card-header">
                <h3 class="stats-title">Task Priority</h3>
              </div>
              <div class="priority-stats">
                <div class="stat-item">
                  <div class="stat-label">
                    <span class="priority-dot critical"></span>
                    <span>Critical</span>
                  </div>
                  <span id="criticalCount" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                  <div class="stat-label">
                    <span class="priority-dot high"></span>
                    <span>High Priority</span>
                  </div>
                  <span id="highCount" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                  <div class="stat-label">
                    <span class="priority-dot medium"></span>
                    <span>Medium Priority</span>
                  </div>
                  <span id="mediumCount" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                  <div class="stat-label">
                    <span class="priority-dot low"></span>
                    <span>Low Priority</span>
                  </div>
                  <span id="lowCount" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                  <div class="stat-label">
                    <span class="priority-dot" style="background-color: var(--overdue-color)"></span>
                    <span>Overdue</span>
                  </div>
                  <span id="overdueCount" class="stat-value">0</span>
                </div>
              </div>
            </div>

            <!-- Activity Feed -->
            <div class="card">
              <div class="card-header">
                <h3 class="stats-title">Team Activity</h3>
              </div>
              <div id="activityFeed">
                <!-- Activity items will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tasks Section -->
      <section id="tasks-section" class="content-section">
        <div class="header">
          <h1 class="header-title">My Tasks</h1>
          <div class="header-actions">
            <button class="btn btn-secondary">
              <i class="fas fa-filter"></i>
              <span>Filters</span>
            </button>
            <button class="btn btn-primary">
              <i class="fas fa-plus"></i>
              <span>New Task</span>
            </button>
          </div>
        </div>

        <div class="task-list-container">
          <div class="task-list-header">
            <h2 class="task-list-title">All Tasks</h2>
            <div class="task-list-filters">
              <button class="filter-btn active">All</button>
              <button class="filter-btn">Today</button>
              <button class="filter-btn">This Week</button>
              <button class="filter-btn">High Priority</button>
            </div>
          </div>

          <div class="task-list">
            <div class="empty-state">
              <i class="fas fa-clipboard-list empty-icon"></i>
              <h3 class="empty-title">No tasks found</h3>
              <p class="empty-description">Create your first task to get started with TaskFlow Pro</p>
              <button class="btn btn-primary">
                <i class="fas fa-plus"></i>
                <span>Create Task</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Calendar Section -->
      <section id="calendar-section" class="content-section">
        <div class="header">
          <h1 class="header-title">Calendar</h1>
          <div class="header-actions">
            <button class="btn btn-primary" id="addEventBtn">
              <i class="fas fa-plus"></i>
              <span>New Event</span>
            </button>
          </div>
        </div>

        <div class="calendar-header">
          <div class="calendar-nav">
            <button class="btn btn-icon btn-secondary" id="prevMonth">
              <i class="fas fa-chevron-left"></i>
            </button>
            <h2 class="calendar-title" id="currentMonth">June 2023</h2>
            <button class="btn btn-icon btn-secondary" id="nextMonth">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <button class="btn btn-secondary" id="todayBtn">
            <i class="fas fa-calendar-day"></i>
            <span>Today</span>
          </button>
        </div>

        <div class="calendar-grid">
          <div class="calendar-day-header">Sun</div>
          <div class="calendar-day-header">Mon</div>
          <div class="calendar-day-header">Tue</div>
          <div class="calendar-day-header">Wed</div>
          <div class="calendar-day-header">Thu</div>
          <div class="calendar-day-header">Fri</div>
          <div class="calendar-day-header">Sat</div>

          <!-- Calendar days will be generated dynamically -->
          <div id="calendarDays" class="calendar-days-container"></div>
        </div>
      </section>

      <!-- Projects Section -->
      <section id="projects-section" class="content-section">
        <div class="header">
          <h1 class="header-title">Projects</h1>
          <div class="header-actions">
            <button class="btn btn-primary" id="addProjectBtn">
              <i class="fas fa-plus"></i>
              <span>New Project</span>
            </button>
          </div>
        </div>

        <div class="empty-state">
          <i class="fas fa-folder-open empty-icon"></i>
          <h3 class="empty-title">No projects yet</h3>
          <p class="empty-description">Create your first project to organize related tasks</p>
          <button class="btn btn-primary" id="emptyStateProjectBtn">
            <i class="fas fa-plus"></i>
            <span>Create Project</span>
          </button>
        </div>
      </section>

      <!-- Reports Section -->
      <section id="reports-section" class="content-section">
        <div class="header">
          <h1 class="header-title">Reports</h1>
          <div class="header-actions">
            <button class="btn btn-secondary" id="exportBtn">
              <i class="fas fa-download"></i>
              <span>Export</span>
            </button>
            <button class="btn btn-primary" id="dateRangeBtn">
              <i class="fas fa-calendar-alt"></i>
              <span>Date Range</span>
            </button>
          </div>
        </div>

        <div class="reports-grid">
          <div class="report-card">
            <div class="report-card-header">
              <h3 class="report-card-title">Tasks Completed</h3>
              <i class="fas fa-check-circle" style="color: var(--success)"></i>
            </div>
            <div class="report-card-value">124</div>
            <div class="report-card-description">+12% from last month</div>
          </div>

          <div class="report-card">
            <div class="report-card-header">
              <h3 class="report-card-title">Tasks Overdue</h3>
              <i class="fas fa-exclamation-circle" style="color: var(--danger)"></i>
            </div>
            <div class="report-card-value">8</div>
            <div class="report-card-description">-3% from last month</div>
          </div>

          <div class="report-card">
            <div class="report-card-header">
              <h3 class="report-card-title">Average Completion</h3>
              <i class="fas fa-clock" style="color: var(--warning)"></i>
            </div>
            <div class="report-card-value">2.4 days</div>
            <div class="report-card-description">Improved by 0.6 days</div>
          </div>

          <div class="report-card">
            <div class="report-card-header">
              <h3 class="report-card-title">High Priority Tasks</h3>
              <i class="fas fa-arrow-up" style="color: var(--priority-high)"></i>
            </div>
            <div class="report-card-value">32</div>
            <div class="report-card-description">18% of total tasks</div>
          </div>

          <div class="report-card">
            <div class="report-card-header">
              <h3 class="report-card-title">Team Productivity</h3>
              <i class="fas fa-users" style="color: var(--primary-600)"></i>
            </div>
            <div class="report-card-value">84%</div>
            <div class="report-card-description">Based on completed tasks</div>
          </div>

          <div class="report-card">
            <div class="report-card-header">
              <h3 class="report-card-title">Task Distribution</h3>
              <i class="fas fa-chart-pie" style="color: var(--secondary-500)"></i>
            </div>
            <div class="report-card-value">3.2/day</div>
            <div class="report-card-description">Average tasks created</div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings-section" class="content-section">
        <div class="header">
          <h1 class="header-title">Settings</h1>
        </div>

        <!-- Account Settings -->
        <div class="settings-section">
          <h2 class="settings-section-title">Account Settings</h2>
          <div class="settings-item">
            <div>
              <div class="settings-item-label">Profile Information</div>
              <div class="settings-item-description">Update your name, email, and profile picture</div>
            </div>
            <button class="btn btn-secondary" id="editProfileBtn">Edit</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-item-label">Change Password</div>
              <div class="settings-item-description">Update your account password</div>
            </div>
            <button class="btn btn-secondary" id="changePasswordBtn">Change</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-item-label">Notification Preferences</div>
              <div class="settings-item-description">Configure how you receive notifications</div>
            </div>
            <button class="btn btn-secondary" id="notificationsBtn">Configure</button>
          </div>
        </div>

        <!-- App Preferences -->
        <div class="settings-section">
          <h2 class="settings-section-title">App Preferences</h2>
          <div class="settings-item">
            <div>
              <div class="settings-item-label">Theme</div>
              <div class="settings-item-description">Light or Dark mode</div>
            </div>
            <button class="btn btn-secondary" id="themeSettingsBtn">Change</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-item-label">Default View</div>
              <div class="settings-item-description">Set your preferred default view</div>
            </div>
            <button class="btn btn-secondary" id="defaultViewBtn">Change</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-item-label">Task Defaults</div>
              <div class="settings-item-description">Set default priority and due date settings</div>
            </div>
            <button class="btn btn-secondary" id="taskDefaultsBtn">Configure</button>
          </div>
        </div>

        <!-- Team Settings -->
        <div class="settings-section">
          <h2 class="settings-section-title">Team Settings</h2>
          <div class="settings-item">
            <div>
              <div class="settings-item-label">Team Members</div>
              <div class="settings-item-description">Manage your team members</div>
            </div>
            <button class="btn btn-secondary" id="teamMembersBtn">Manage</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-item-label">Team Roles</div>
              <div class="settings-item-description">Configure roles and permissions</div>
            </div>
            <button class="btn btn-secondary" id="teamRolesBtn">Configure</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Task Modal -->
  <div id="taskModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle" class="modal-title">Add New Task</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="taskForm">
        <div class="modal-body">
          <input type="hidden" id="taskId">
          <div class="form-group">
            <label for="taskTitle" class="form-label">Task Title</label>
            <input type="text" id="taskTitle" class="form-control" placeholder="What needs to be done?" required>
          </div>
          <div class="form-group">
            <label for="taskDescription" class="form-label">Description</label>
            <textarea id="taskDescription" class="form-control" rows="3" placeholder="Add details..."></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Priority</label>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" id="criticalPriority" name="priority" value="critical" class="radio-input">
                <label for="criticalPriority" class="radio-label">Critical</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="highPriority" name="priority" value="high" class="radio-input" checked>
                <label for="highPriority" class="radio-label">High</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="mediumPriority" name="priority" value="medium" class="radio-input">
                <label for="mediumPriority" class="radio-label">Medium</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="lowPriority" name="priority" value="low" class="radio-input">
                <label for="lowPriority" class="radio-label">Low</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="dueDate" class="form-label">Due Date</label>
            <input type="date" id="dueDate" class="form-control">
          </div>
          <div class="form-group">
            <label for="taskTeam" class="form-label">Team</label>
            <select id="taskTeam" class="form-control">
              <option value="">Personal Task</option>
              <option value="Development">Development</option>
              <option value="Marketing">Marketing</option>
              <option value="Design">Design</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" id="submitBtn" class="btn btn-primary">Add Task</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Event Modal -->
  <div id="eventModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="eventModalTitle" class="modal-title">Add New Event</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="eventForm">
        <div class="modal-body">
          <input type="hidden" id="eventId">
          <div class="form-group">
            <label for="eventTitle" class="form-label">Event Title</label>
            <input type="text" id="eventTitle" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="eventDate" class="form-label">Date</label>
            <input type="date" id="eventDate" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="eventDescription" class="form-label">Description</label>
            <textarea id="eventDescription" class="form-control" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" id="submitEventBtn" class="btn btn-primary">Save Event</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Project Modal -->
  <div id="projectModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Create New Project</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="projectForm">
        <div class="modal-body">
          <div class="form-group">
            <label for="projectName" class="form-label">Project Name</label>
            <input type="text" id="projectName" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="projectDescription" class="form-label">Description</label>
            <textarea id="projectDescription" class="form-control" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="projectTeam" class="form-label">Team</label>
            <select id="projectTeam" class="form-control">
              <option value="">Personal Project</option>
              <option value="Development">Development</option>
              <option value="Marketing">Marketing</option>
              <option value="Design">Design</option>
            </select>
          </div>
          <div class="form-group">
            <label for="projectStartDate" class="form-label">Start Date</label>
            <input type="date" id="projectStartDate" class="form-control">
          </div>
          <div class="form-group">
            <label for="projectEndDate" class="form-label">End Date</label>
            <input type="date" id="projectEndDate" class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Project</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Date Range Modal -->
  <div id="dateRangeModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title">Select Date Range</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="dateRangeForm">
        <div class="modal-body">
          <div class="form-group">
            <label for="startDate" class="form-label">Start Date</label>
            <input type="date" id="startDate" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="endDate" class="form-label">End Date</label>
            <input type="date" id="endDate" class="form-control" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Apply</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Export Modal -->
  <div id="exportModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title">Export Reports</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Select Export Format</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="csvFormat" name="exportFormat" value="csv" class="radio-input" checked>
              <label for="csvFormat" class="radio-label">CSV</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="jsonFormat" name="exportFormat" value="json" class="radio-input">
              <label for="jsonFormat" class="radio-label">JSON</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="pdfFormat" name="exportFormat" value="pdf" class="radio-input">
              <label for="pdfFormat" class="radio-label">PDF</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="docxFormat" name="exportFormat" value="docx" class="radio-input">
              <label for="docxFormat" class="radio-label">Word (DOCX)</label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
        <button type="button" id="confirmExportBtn" class="btn btn-primary">Export</button>
      </div>
    </div>
  </div>

  <!-- Profile Settings Modal -->
  <div id="profileModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">Edit Profile</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="profileForm">
        <div class="modal-body">
          <div class="form-group">
            <label for="profileName" class="form-label">Name</label>
            <input type="text" id="profileName" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="profileEmail" class="form-label">Email</label>
            <input type="email" id="profileEmail" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="profileAvatar" class="form-label">Profile Picture URL</label>
            <input type="url" id="profileAvatar" class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Password Change Modal -->
  <div id="passwordModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">Change Password</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="passwordForm">
        <div class="modal-body">
          <div class="form-group">
            <label for="currentPassword" class="form-label">Current Password</label>
            <input type="password" id="currentPassword" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="newPassword" class="form-label">New Password</label>
            <input type="password" id="newPassword" class="form-control" required minlength="8">
            <small class="text-secondary">Minimum 8 characters</small>
          </div>
          <div class="form-group">
            <label for="confirmPassword" class="form-label">Confirm New Password</label>
            <input type="password" id="confirmPassword" class="form-control" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Password</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Notifications Modal -->
  <div id="notificationsModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">Notification Preferences</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="notificationsForm">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Email Notifications</label>
            <div class="radio-group" style="flex-direction: column; gap: 8px;">
              <label class="radio-option" style="display: flex; align-items: center; padding: 8px 0;">
                <input type="radio" name="emailNotifications" value="all" class="radio-input" checked>
                <span style="margin-left: 8px;">All notifications</span>
              </label>
              <label class="radio-option" style="display: flex; align-items: center; padding: 8px 0;">
                <input type="radio" name="emailNotifications" value="important" class="radio-input">
                <span style="margin-left: 8px;">Only important</span>
              </label>
              <label class="radio-option" style="display: flex; align-items: center; padding: 8px 0;">
                <input type="radio" name="emailNotifications" value="none" class="radio-input">
                <span style="margin-left: 8px;">None</span>
              </label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Push Notifications</label>
            <div style="display: flex; align-items: center; gap: 16px;">
              <label class="switch">
                <input type="checkbox" id="pushNotifications" checked>
                <span class="slider round"></span>
              </label>
              <span>Enable push notifications</span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Preferences</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Default View Modal -->
  <div id="defaultViewModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">Default View</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="defaultViewForm">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Select Default View</label>
            <select id="defaultViewSelect" class="form-control">
              <option value="dashboard">Dashboard</option>
              <option value="tasks">Tasks</option>
              <option value="calendar">Calendar</option>
              <option value="projects">Projects</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Set Default</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Team Members Modal -->
  <div id="teamMembersModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title">Manage Team Members</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="teamMembersForm">
        <div class="modal-body">
          <div class="form-group">
            <label for="teamSelect" class="form-label">Select Team</label>
            <select id="teamSelect" class="form-control">
              <option value="development">Development</option>
              <option value="marketing">Marketing</option>
              <option value="design">Design</option>
            </select>
          </div>
          
          <div class="team-members-list" style="margin-top: 20px;">
            <h4 style="margin-bottom: 10px;">Current Members</h4>
            <div id="membersContainer" style="max-height: 200px; overflow-y: auto;">
              <!-- Members will be loaded here -->
            </div>
          </div>
          
          <div class="form-group" style="margin-top: 20px;">
            <label for="addMemberEmail" class="form-label">Add New Member</label>
            <div style="display: flex; gap: 10px;">
              <input type="email" id="addMemberEmail" class="form-control" placeholder="Member's email">
              <button type="button" id="addMemberBtn" class="btn btn-primary">Add</button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Team Roles Modal -->
  <div id="teamRolesModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title">Team Roles & Permissions</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="teamRolesForm">
        <div class="modal-body">
          <div class="form-group">
            <label for="rolesTeamSelect" class="form-label">Select Team</label>
            <select id="rolesTeamSelect" class="form-control">
              <option value="development">Development</option>
              <option value="marketing">Marketing</option>
              <option value="design">Design</option>
            </select>
          </div>
          
          <div class="roles-container" style="margin-top: 20px;">
            <h4 style="margin-bottom: 15px;">Role Permissions</h4>
            <div class="role-item" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);">
              <h5 style="margin-bottom: 10px;">Admin</h5>
              <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                <label class="permission-tag">
                  <input type="checkbox" checked disabled> All permissions
                </label>
              </div>
            </div>
            <div class="role-item" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);">
              <h5 style="margin-bottom: 10px;">Member</h5>
              <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                <label class="permission-tag">
                  <input type="checkbox" name="member-permissions" value="create-tasks" checked> Create tasks
                </label>
                <label class="permission-tag">
                  <input type="checkbox" name="member-permissions" value="edit-tasks" checked> Edit tasks
                </label>
                <label class="permission-tag">
                  <input type="checkbox" name="member-permissions" value="delete-tasks"> Delete tasks
                </label>
                <label class="permission-tag">
                  <input type="checkbox" name="member-permissions" value="invite-members"> Invite members
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Permissions</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Task Defaults Modal -->
  <div id="taskDefaultsModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">Task Default Settings</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="taskDefaultsForm">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Default Priority</label>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" id="defaultCritical" name="defaultPriority" value="critical" class="radio-input">
                <label for="defaultCritical" class="radio-label">Critical</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="defaultHigh" name="defaultPriority" value="high" class="radio-input" checked>
                <label for="defaultHigh" class="radio-label">High</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="defaultMedium" name="defaultPriority" value="medium" class="radio-input">
                <label for="defaultMedium" class="radio-label">Medium</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="defaultLow" name="defaultPriority" value="low" class="radio-input">
                <label for="defaultLow" class="radio-label">Low</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="defaultDueDays" class="form-label">Default Due Date</label>
            <select id="defaultDueDays" class="form-control">
              <option value="0">No default</option>
              <option value="1">1 day from now</option>
              <option value="3" selected>3 days from now</option>
              <option value="7">1 week from now</option>
              <option value="14">2 weeks from now</option>
              <option value="30">1 month from now</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Defaults</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Focus Mode -->
  <div id="focusContainer" class="focus-container">
    <h2>Focus Mode</h2>
    <div class="focus-timer">25:00</div>
    <div class="focus-task">Working on: <span id="focusTaskTitle"></span></div>
    <div class="focus-actions">
      <button id="pauseFocusBtn" class="btn btn-secondary">Pause</button>
      <button id="endFocusBtn" class="btn btn-primary">End Session</button>
    </div>
  </div>

  <!-- AI Assistant -->
  <div id="aiAssistant" class="ai-assistant">
    <div class="ai-header">
      <h3>AI Assistant</h3>
      <button class="ai-close">&times;</button>
    </div>
    <div class="ai-messages" id="aiMessages">
      <div class="ai-message ai">
        <div class="ai-message-content">Hi! I'm your TaskFlow AI assistant. How can I help you today?</div>
        <div class="ai-message-time">Just now</div>
      </div>
    </div>
    <div class="ai-input-container">
      <input type="text" class="ai-input" id="aiInput" placeholder="Ask me anything...">
      <button class="ai-send-btn" id="aiSendBtn">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <i class="fas fa-check-circle toast-icon"></i>
    <span id="toastMessage" class="toast-message">Task added successfully</span>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM Elements
      const taskForm = document.getElementById('taskForm');
      const eventForm = document.getElementById('eventForm');
      const projectForm = document.getElementById('projectForm');
      const dateRangeForm = document.getElementById('dateRangeForm');
      const taskModal = document.getElementById('taskModal');
      const eventModal = document.getElementById('eventModal');
      const projectModal = document.getElementById('projectModal');
      const dateRangeModal = document.getElementById('dateRangeModal');
      const exportModal = document.getElementById('exportModal');
      const addTaskBtn = document.getElementById('addTaskBtn');
      const addEventBtn = document.getElementById('addEventBtn');
      const addProjectBtn = document.getElementById('addProjectBtn');
      const emptyStateAddBtn = document.getElementById('emptyStateAddBtn');
      const emptyStateProjectBtn = document.getElementById('emptyStateProjectBtn');
      const modalCloseBtns = document.querySelectorAll('.modal-close');
      const modalCloseBtn2 = document.querySelector('.modal-close-btn');
      const taskList = document.getElementById('taskList');
      const modalTitle = document.getElementById('modalTitle');
      const eventModalTitle = document.getElementById('eventModalTitle');
      const submitBtn = document.getElementById('submitBtn');
      const submitEventBtn = document.getElementById('submitEventBtn');
      const taskIdInput = document.getElementById('taskId');
      const eventIdInput = document.getElementById('eventId');
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      const activityFeed = document.getElementById('activityFeed');
      const themeToggle = document.getElementById('themeToggle');
      const exportBtn = document.getElementById('exportBtn');
      const dateRangeBtn = document.getElementById('dateRangeBtn');
      const confirmExportBtn = document.getElementById('confirmExportBtn');
      const aiToggle = document.getElementById('aiToggle');
      const aiAssistant = document.getElementById('aiAssistant');
      const aiMessages = document.getElementById('aiMessages');
      const aiInput = document.getElementById('aiInput');
      const aiSendBtn = document.getElementById('aiSendBtn');
      const aiCloseBtn = document.querySelector('.ai-close');
      
      // Calendar Elements
      const prevMonthBtn = document.getElementById('prevMonth');
      const nextMonthBtn = document.getElementById('nextMonth');
      const todayBtn = document.getElementById('todayBtn');
      const currentMonthEl = document.getElementById('currentMonth');
      const calendarDaysEl = document.getElementById('calendarDays');
      
      // Navigation Elements
      const navItems = document.querySelectorAll('.nav-menu .nav-item');
      const contentSections = document.querySelectorAll('.content-section');
      const teamNavItems = document.querySelectorAll('.team-section .nav-item');
      
      // Focus Mode Elements
      const focusContainer = document.getElementById('focusContainer');
      const focusTaskTitle = document.getElementById('focusTaskTitle');
      const focusTimer = document.querySelector('.focus-timer');
      const pauseFocusBtn = document.getElementById('pauseFocusBtn');
      const endFocusBtn = document.getElementById('endFocusBtn');
      
      // Initialize tasks from localStorage or empty array
      let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
      let events = JSON.parse(localStorage.getItem('events')) || [
        { id: 1, title: "Team Meeting", date: new Date(new Date().setDate(new Date().getDate() + 3)).toISOString().split('T')[0], description: "Weekly team sync" },
        { id: 2, title: "Project Deadline", date: new Date(new Date().setDate(new Date().getDate() + 7)).toISOString().split('T')[0], description: "Submit final project deliverables" },
        { id: 3, title: "Client Call", date: new Date(new Date().setDate(new Date().getDate() + 13)).toISOString().split('T')[0], description: "Discuss project requirements" },
        { id: 4, title: "Sprint Planning", date: new Date(new Date().setDate(new Date().getDate() + 20)).toISOString().split('T')[0], description: "Plan next sprint tasks" },
        { id: 5, title: "Demo Day", date: new Date(new Date().setDate(new Date().getDate() + 28)).toISOString().split('T')[0], description: "Showcase new features to stakeholders" }
      ];
      
      let projects = JSON.parse(localStorage.getItem('projects')) || [];
      let teams = [
        { id: 1, name: "Development", members: 5, tasks: 12 },
        { id: 2, name: "Marketing", members: 3, tasks: 8 },
        { id: 3, name: "Design", members: 4, tasks: 6 }
      ];
      
      let currentTeam = teams[0];
      let isEditing = false;
      let currentEditId = null;
      let isEditingEvent = false;
      let currentEditEventId = null;
      
      // Calendar variables
      let currentDate = new Date();
      let currentMonth = currentDate.getMonth();
      let currentYear = currentDate.getFullYear();
      
      // Focus Mode variables
      let focusTimeLeft = 25 * 60; // 25 minutes in seconds
      let focusInterval;
      let isFocusPaused = false;
      
      // Initialize Chart
      const ctx = document.getElementById('progressChart').getContext('2d');
      const progressChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Completed', 'Pending'],
          datasets: [{
            data: [0, 0],
            backgroundColor: [
              'var(--secondary-500)',
              'var(--primary-500)'
            ],
            borderWidth: 0,
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20
              }
            }
          }
        }
      });
      
      // Theme Toggle Functionality
      function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        // Update toggle button
        const icon = themeToggle.querySelector('i');
        const text = themeToggle.querySelector('span');
        if (newTheme === 'dark') {
          icon.className = 'fas fa-sun';
          text.textContent = 'Light Mode';
        } else {
          icon.className = 'fas fa-moon';
          text.textContent = 'Dark Mode';
        }
        
        // Update chart colors if needed
        updateChartColors(newTheme);
      }
      
      function updateChartColors(theme) {
        if (theme === 'dark') {
          progressChart.data.datasets[0].backgroundColor = ['var(--secondary-400)', 'var(--primary-400)'];
        } else {
          progressChart.data.datasets[0].backgroundColor = ['var(--secondary-500)', 'var(--primary-500)'];
        }
        progressChart.update();
      }
      
      // Initialize theme
      function initTheme() {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // Update toggle button
        const icon = themeToggle.querySelector('i');
        const text = themeToggle.querySelector('span');
        if (savedTheme === 'dark') {
          icon.className = 'fas fa-sun';
          text.textContent = 'Light Mode';
        } else {
          icon.className = 'fas fa-moon';
          text.textContent = 'Dark Mode';
        }
        
        updateChartColors(savedTheme);
      }
      
      // Event listener for theme toggle
      themeToggle.addEventListener('click', toggleTheme);
      
      // Navigation Handling
      navItems.forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Remove active class from all nav items
          navItems.forEach(navItem => {
            navItem.classList.remove('active');
          });
          
          // Add active class to clicked nav item
          this.classList.add('active');
          
          // Get the section to show
          const sectionId = this.getAttribute('data-section');
          
          // Hide all content sections
          contentSections.forEach(section => {
            section.classList.remove('active');
          });
          
          // Show the selected content section with sliding effect
          document.getElementById(`${sectionId}-section`).classList.add('active');
          
          // If calendar section, render the calendar
          if (sectionId === 'calendar') {
            renderCalendar();
          }
        });
      });
      
      // Team Navigation Handling
      teamNavItems.forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Remove active class from all team nav items
          teamNavItems.forEach(navItem => {
            navItem.classList.remove('active');
          });
          
          // Add active class to clicked team
          this.classList.add('active');
          
          // Set current team
          const teamName = this.querySelector('span').textContent;
          currentTeam = teams.find(team => team.name === teamName);
          
          // Update header title
          document.querySelector('.header-title').textContent = `${teamName} Team Dashboard`;
          
          // Show team-specific tasks
          renderTeamTasks();
          
          // Show dashboard section
          document.getElementById('dashboard-section').classList.add('active');
          document.querySelector('.nav-menu .nav-item[data-section="dashboard"]').classList.add('active');
        });
      });
      
      // Render Team Tasks
      function renderTeamTasks() {
        if (!currentTeam) return;
        
        // Filter tasks for this team (in a real app, tasks would have teamId)
        const teamTasks = tasks.filter(task => 
          task.team === currentTeam.name
        );
        
        const taskList = document.getElementById('taskList');
        
        if (teamTasks.length === 0) {
          taskList.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-clipboard-list empty-icon"></i>
              <h3 class="empty-title">No tasks for ${currentTeam.name} team</h3>
              <p class="empty-description">Create a new task to get started</p>
              <button id="emptyStateAddBtn" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                <span>Create Task</span>
              </button>
            </div>
          `;
          document.getElementById('emptyStateAddBtn').addEventListener('click', openTaskModal);
          return;
        }
        
        taskList.innerHTML = '';
        
        // Sort tasks: completed at bottom, then by priority (critical to low), then by due date (soonest first)
        const sortedTasks = [...teamTasks].sort((a, b) => {
          if (a.completed !== b.completed) return a.completed ? 1 : -1;
          if (a.priority !== b.priority) {
            const priorityOrder = { critical: 1, high: 2, medium: 3, low: 4 };
            return priorityOrder[a.priority] - priorityOrder[b.priority];
          }
          if (a.dueDate && b.dueDate) {
            return new Date(a.dueDate) - new Date(b.dueDate);
          }
          return new Date(b.createdAt) - new Date(a.createdAt); // Newest first if no due date
        });
        
        sortedTasks.forEach((task) => {
          const taskElement = document.createElement('div');
          taskElement.className = `task-item ${task.completed ? 'completed' : ''}`;
          taskElement.dataset.id = task.id;
          
          // Check if task is overdue
          const isOverdue = task.dueDate && !task.completed && new Date(task.dueDate) < new Date();
          if (isOverdue) {
            taskElement.classList.add('overdue');
          }
          
          // Format due date if exists
          let dueDateDisplay = '';
          if (task.dueDate) {
            const dueDate = new Date(task.dueDate);
            dueDateDisplay = `
              <div class="task-due-date ${isOverdue ? 'overdue' : ''}">
                <i class="far fa-calendar-alt"></i>
                ${dueDate.toLocaleDateString()} ${isOverdue ? '(Overdue)' : ''}
              </div>
            `;
          }
          
          taskElement.innerHTML = `
            <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
            <div class="task-content">
              <div class="task-title ${task.completed ? 'completed' : ''}">
                ${task.title}
                <span class="task-priority priority-${task.priority}">${task.priority}</span>
                ${task.team ? `<span class="team-badge">${task.team}</span>` : ''}
              </div>
              ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
              <div class="task-meta">
                ${dueDateDisplay}
              </div>
            </div>
            <div class="task-actions">
              <button class="btn btn-icon btn-secondary edit-btn">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-icon btn-secondary delete-btn">
                <i class="fas fa-trash"></i>
              </button>
              <button class="btn btn-icon btn-secondary focus-btn">
                <i class="fas fa-hourglass-start"></i>
              </button>
            </div>
          `;
          
          // Add event listeners
          const checkbox = taskElement.querySelector('.task-checkbox');
          const deleteBtn = taskElement.querySelector('.delete-btn');
          const editBtn = taskElement.querySelector('.edit-btn');
          const focusBtn = taskElement.querySelector('.focus-btn');
          
          checkbox.addEventListener('change', () => {
            const taskIndex = tasks.findIndex(t => t.id === task.id);
            if (taskIndex !== -1) {
              tasks[taskIndex].completed = checkbox.checked;
              tasks[taskIndex].updatedAt = new Date().toISOString();  
              saveTasks();
              renderTeamTasks();
              updateStats();
              addActivity(`Marked task "${task.title}" as ${checkbox.checked ? 'completed' : 'incomplete'}`);
              showToast(`Task marked as ${checkbox.checked ? 'completed' : 'incomplete'}`, 'success');
            }
          });
          
          deleteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm('Are you sure you want to delete this task?')) {
              const taskTitle = tasks.find(t => t.id === task.id).title;
              tasks = tasks.filter(t => t.id !== task.id);
              saveTasks();
              renderTeamTasks();
              updateStats();
              addActivity(`Deleted task "${taskTitle}"`);
              showToast('Task deleted successfully!', 'success');
            }
          });
          
          editBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            editTask(task);
          });
          
          focusBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            startFocusSession(task);
          });
          
          // Click to view details
          taskElement.addEventListener('click', (e) => {
            if (!e.target.classList.contains('task-checkbox') && 
                !e.target.classList.contains('edit-btn') && 
                !e.target.classList.contains('delete-btn') &&
                !e.target.classList.contains('focus-btn') &&
                !e.target.classList.contains('btn') &&
                e.target.tagName !== 'I') {
              viewTaskDetails(task);
            }
          });
          
          taskList.appendChild(taskElement);
        });
      }
      
      // Modal Handling
      function openTaskModal() {
        isEditing = false;
        currentEditId = null;
        modalTitle.textContent = 'Add New Task';
        submitBtn.textContent = 'Add Task';
        taskForm.reset();
        taskIdInput.value = '';
        taskModal.classList.add('active');
        
        // Set default team if viewing a team dashboard
        if (currentTeam) {
          document.getElementById('taskTeam').value = currentTeam.name;
        }
      }
      
      function openEventModal() {
        isEditingEvent = false;
        currentEditEventId = null;
        eventModalTitle.textContent = 'Add New Event';
        submitEventBtn.textContent = 'Add Event';
        eventForm.reset();
        eventIdInput.value = '';
        eventModal.classList.add('active');
      }
      
      function openProjectModal() {
        projectForm.reset();
        projectModal.classList.add('active');
      }
      
      function openDateRangeModal() {
        dateRangeForm.reset();
        dateRangeModal.classList.add('active');
      }
      
      function closeModal() {
        taskModal.classList.remove('active');
        eventModal.classList.remove('active');
        projectModal.classList.remove('active');
        dateRangeModal.classList.remove('active');
        exportModal.classList.remove('active');
      }
      
      addTaskBtn.addEventListener('click', openTaskModal);
      addEventBtn.addEventListener('click', openEventModal);
      addProjectBtn.addEventListener('click', openProjectModal);
      emptyStateAddBtn.addEventListener('click', openTaskModal);
      emptyStateProjectBtn.addEventListener('click', openProjectModal);
      dateRangeBtn.addEventListener('click', openDateRangeModal);
      
      modalCloseBtns.forEach(btn => {
        btn.addEventListener('click', closeModal);
      });
      
      if (modalCloseBtn2) {
        modalCloseBtn2.addEventListener('click', closeModal);
      }
      
      window.addEventListener('click', (e) => {
        if (e.target === taskModal || e.target === eventModal || e.target === projectModal || 
            e.target === dateRangeModal || e.target === exportModal) {
          closeModal();
        }
      });
      
      // Export Functionality
      function exportToCSV(data) {
        let csv = 'Metric,Value,Change\n';
        data.forEach(item => {
          csv += `"${item.metric}","${item.value}","${item.change}"\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `TaskFlow_Report_${new Date().toISOString().slice(0,10)}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showToast('Report exported as CSV', 'success');
      }
      
      function exportToJSON(data) {
        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: 'application/json;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `TaskFlow_Report_${new Date().toISOString().slice(0,10)}.json`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showToast('Report exported as JSON', 'success');
      }
      
      function exportToPDF(data) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Add title
        doc.setFontSize(18);
        doc.text('TaskFlow Pro Report', 105, 20, { align: 'center' });
        
        // Add date
        doc.setFontSize(12);
        doc.text(`Generated: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
        
        // Add table
        doc.setFontSize(12);
        doc.text('Metric', 20, 50);
        doc.text('Value', 100, 50);
        doc.text('Change', 160, 50);
        
        let y = 60;
        data.forEach(item => {
          doc.text(item.metric, 20, y);
          doc.text(item.value.toString(), 100, y);
          doc.text(item.change, 160, y);
          y += 10;
        });
        
        // Add footer
        doc.setFontSize(10);
        doc.text('© TaskFlow Pro', 105, 290, { align: 'center' });
        
        doc.save(`TaskFlow_Report_${new Date().toISOString().slice(0,10)}.pdf`);
        
        showToast('Report exported as PDF', 'success');
      }
      
      function exportToDOCX(data) {
        const { Document, Paragraph, TextRun, Packer } = docx;
        
        const doc = new Document({
          title: "TaskFlow Pro Report",
          description: "Generated report from TaskFlow Pro",
          styles: {
            paragraphStyles: [
              {
                id: "title",
                name: "Title",
                run: {
                  size: 36,
                  bold: true,
                },
                paragraph: {
                  spacing: {
                    after: 200,
                  },
                  alignment: "center",
                },
              },
              {
                id: "heading1",
                name: "Heading 1",
                run: {
                  size: 28,
                  bold: true,
                },
                paragraph: {
                  spacing: {
                    before: 240,
                    after: 120,
                  },
                },
              },
              {
                id: "normal",
                name: "Normal",
                run: {
                  size: 24,
                },
                paragraph: {
                  spacing: {
                    line: 276,
                  },
                },
              },
            ],
          },
          sections: [
            {
              properties: {},
              children: [
                new Paragraph({
                  text: "TaskFlow Pro Report",
                  style: "title",
                }),
                new Paragraph({
                  text: `Generated: ${new Date().toLocaleDateString()}`,
                  style: "normal",
                }),
                new Paragraph({
                  text: " ",
                }),
                new Paragraph({
                  text: "Report Data",
                  style: "heading1",
                }),
                ...data.map(item => 
                  new Paragraph({
                    children: [
                      new TextRun({
                        text: `${item.metric}: `,
                        bold: true,
                      }),
                      new TextRun({
                        text: `${item.value} (${item.change})`,
                      }),
                    ],
                    style: "normal",
                  })
                ),
              ],
            },
          ],
        });
        
        Packer.toBlob(doc).then(blob => {
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `TaskFlow_Report_${new Date().toISOString().slice(0,10)}.docx`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          showToast('Report exported as DOCX', 'success');
        });
      }
      
      // Export Modal Handling
      exportBtn.addEventListener('click', () => {
        exportModal.classList.add('active');
      });
      
      confirmExportBtn.addEventListener('click', () => {
        const format = document.querySelector('input[name="exportFormat"]:checked').value;
        exportModal.classList.remove('active');
        
        // Create the data to export
        const reportsData = [
          { metric: "Tasks Completed", value: 124, change: "+12% from last month" },
          { metric: "Tasks Overdue", value: 8, change: "-3% from last month" },
          { metric: "Average Completion", value: "2.4 days", change: "Improved by 0.6 days" },
          { metric: "High Priority Tasks", value: 32, change: "18% of total tasks" },
          { metric: "Team Productivity", value: "84%", change: "Based on completed tasks" },
          { metric: "Task Distribution", value: "3.2/day", change: "Average tasks created" }
        ];
        
        switch(format) {
          case "csv":
            exportToCSV(reportsData);
            break;
          case "json":
            exportToJSON(reportsData);
            break;
          case "pdf":
            exportToPDF(reportsData);
            break;
          case "docx":
            exportToDOCX(reportsData);
            break;
          default:
            exportToCSV(reportsData);
        }
      });
      
      // Form Submission
      taskForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const title = document.getElementById('taskTitle').value.trim();
        const description = document.getElementById('taskDescription').value.trim();
        const priority = document.querySelector('input[name="priority"]:checked').value;
        const dueDate = document.getElementById('dueDate').value;
        const team = document.getElementById('taskTeam').value;
        const id = taskIdInput.value || Date.now();
        
        if (!title) {
          showToast('Task title is required!', 'error');
          return;
        }
        
        const taskData = {
          id,
          title,
          description,
          priority,
          dueDate,
          team,
          completed: false,
          createdAt: isEditing ? tasks.find(t => t.id == id).createdAt : new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        
        if (isEditing) {
          // Update existing task
          const index = tasks.findIndex(task => task.id == currentEditId);
          if (index !== -1) {
            tasks[index] = {
              ...tasks[index],
              ...taskData,
              completed: tasks[index].completed // Preserve completion status
            };
            addActivity(`Updated task "${title}"`);
            showToast('Task updated successfully!', 'success');
          }
        } else {
          // Add new task
          tasks.unshift(taskData); // Add new tasks at the beginning
          addActivity(`Created new task "${title}"`);
          showToast('Task added successfully!', 'success');
        }
        
        saveTasks();
        if (currentTeam && team === currentTeam.name) {
          renderTeamTasks();
        } else {
          renderTasks();
        }
        updateStats();
        closeModal();
      });
      
      // Event Form Submission
      eventForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const title = document.getElementById('eventTitle').value.trim();
        const date = document.getElementById('eventDate').value;
        const description = document.getElementById('eventDescription').value.trim();
        const id = eventIdInput.value || Date.now();
        
        if (!title || !date) {
          showToast('Event title and date are required!', 'error');
          return;
        }
        
        const eventData = {
          id,
          title,
          date,
          description
        };
        
        if (isEditingEvent) {
          // Update existing event
          const index = events.findIndex(event => event.id == currentEditEventId);
          if (index !== -1) {
            events[index] = eventData;
            addActivity(`Updated event "${title}"`);
            showToast('Event updated successfully!', 'success');
          }
        } else {
          // Add new event
          events.push(eventData);
          addActivity(`Created new event "${title}"`);
          showToast('Event added successfully!', 'success');
        }
        
        saveEvents();
        renderCalendar();
        closeModal();
      });
      
      // Project Form Submission
      projectForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const name = document.getElementById('projectName').value.trim();
        const description = document.getElementById('projectDescription').value.trim();
        const team = document.getElementById('projectTeam').value;
        const startDate = document.getElementById('projectStartDate').value;
        const endDate = document.getElementById('projectEndDate').value;
        
        if (!name) {
          showToast('Project name is required!', 'error');
          return;
        }
        
        const projectData = {
          id: Date.now(),
          name,
          description,
          team,
          startDate,
          endDate,
          createdAt: new Date().toISOString()
        };
        
        projects.push(projectData);
        saveProjects();
        addActivity(`Created new project "${name}"`);
        showToast('Project created successfully!', 'success');
        closeModal();
        
        // In a real app, you would update the projects list view
      });
      
      // Date Range Form Submission
      dateRangeForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        
        if (!startDate || !endDate) {
          showToast('Both start and end dates are required!', 'error');
          return;
        }
        
        if (new Date(startDate) > new Date(endDate)) {
          showToast('Start date must be before end date!', 'error');
          return;
        }
        
        showToast(`Date range set: ${startDate} to ${endDate}`, 'success');
        closeModal();
      });
      
      // Save to localStorage
      function saveTasks() {
        localStorage.setItem('tasks', JSON.stringify(tasks));
      }
      
      function saveEvents() {
        localStorage.setItem('events', JSON.stringify(events));
      }
      
      function saveProjects() {
        localStorage.setItem('projects', JSON.stringify(projects));
      }
      
      function saveTeams() {
        localStorage.setItem('teams', JSON.stringify(teams));
      }
      
      // Render Tasks
      function renderTasks() {
        if (tasks.length === 0) {
          taskList.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-clipboard-list empty-icon"></i>
              <h3 class="empty-title">No tasks found</h3>
              <p class="empty-description">Create your first task to get started with TaskFlow Pro</p>
              <button id="emptyStateAddBtn" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                <span>Create Task</span>
              </button>
            </div>
          `;
          document.getElementById('emptyStateAddBtn').addEventListener('click', openTaskModal);
          return;
        }
        
        taskList.innerHTML = '';
        
        // Sort tasks: completed at bottom, then by priority (critical to low), then by due date (soonest first)
        const sortedTasks = [...tasks].sort((a, b) => {
          if (a.completed !== b.completed) return a.completed ? 1 : -1;
          if (a.priority !== b.priority) {
            const priorityOrder = { critical: 1, high: 2, medium: 3, low: 4 };
            return priorityOrder[a.priority] - priorityOrder[b.priority];
          }
          if (a.dueDate && b.dueDate) {
            return new Date(a.dueDate) - new Date(b.dueDate);
          }
          return new Date(b.createdAt) - new Date(a.createdAt); // Newest first if no due date
        });
        
        sortedTasks.forEach((task) => {
          const taskElement = document.createElement('div');
          taskElement.className = `task-item ${task.completed ? 'completed' : ''}`;
          taskElement.dataset.id = task.id;
          
          // Check if task is overdue
          const isOverdue = task.dueDate && !task.completed && new Date(task.dueDate) < new Date();
          if (isOverdue) {
            taskElement.classList.add('overdue');
          }
          
          // Format due date if exists
          let dueDateDisplay = '';
          if (task.dueDate) {
            const dueDate = new Date(task.dueDate);
            dueDateDisplay = `
              <div class="task-due-date ${isOverdue ? 'overdue' : ''}">
                <i class="far fa-calendar-alt"></i>
                ${dueDate.toLocaleDateString()} ${isOverdue ? '(Overdue)' : ''}
              </div>
            `;
          }
          
          taskElement.innerHTML = `
            <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
            <div class="task-content">
              <div class="task-title ${task.completed ? 'completed' : ''}">
                ${task.title}
                <span class="task-priority priority-${task.priority}">${task.priority}</span>
                ${task.team ? `<span class="team-badge">${task.team}</span>` : ''}
              </div>
              ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
              <div class="task-meta">
                ${dueDateDisplay}
              </div>
            </div>
            <div class="task-actions">
              <button class="btn btn-icon btn-secondary edit-btn">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-icon btn-secondary delete-btn">
                <i class="fas fa-trash"></i>
              </button>
              <button class="btn btn-icon btn-secondary focus-btn">
                <i class="fas fa-hourglass-start"></i>
              </button>
            </div>
          `;
          
          // Add event listeners
          const checkbox = taskElement.querySelector('.task-checkbox');
          const deleteBtn = taskElement.querySelector('.delete-btn');
          const editBtn = taskElement.querySelector('.edit-btn');
          const focusBtn = taskElement.querySelector('.focus-btn');
          
          checkbox.addEventListener('change', () => {
            const taskIndex = tasks.findIndex(t => t.id === task.id);
            if (taskIndex !== -1) {
              tasks[taskIndex].completed = checkbox.checked;
              tasks[taskIndex].updatedAt = new Date().toISOString();
              saveTasks();
              renderTasks();
              updateStats();
              addActivity(`Marked task "${task.title}" as ${checkbox.checked ? 'completed' : 'incomplete'}`);
              showToast(`Task marked as ${checkbox.checked ? 'completed' : 'incomplete'}`, 'success');
            }
          });
          
          deleteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm('Are you sure you want to delete this task?')) {
              const taskTitle = tasks.find(t => t.id === task.id).title;
              tasks = tasks.filter(t => t.id !== task.id);
              saveTasks();
              renderTasks();
              updateStats();
              addActivity(`Deleted task "${taskTitle}"`);
              showToast('Task deleted successfully!', 'success');
            }
          });
          
          editBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            editTask(task);
          });
          
          focusBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            startFocusSession(task);
          });
          
          // Click to view details
          taskElement.addEventListener('click', (e) => {
            if (!e.target.classList.contains('task-checkbox') && 
                !e.target.classList.contains('edit-btn') && 
                !e.target.classList.contains('delete-btn') &&
                !e.target.classList.contains('focus-btn') &&
                !e.target.classList.contains('btn') &&
                e.target.tagName !== 'I') {
              viewTaskDetails(task);
            }
          });
          
          taskList.appendChild(taskElement);
        });
      }
      
      // Calendar Functionality
      function renderCalendar() {
        // Clear previous calendar days
        calendarDaysEl.innerHTML = '';
        
        // Set month and year in header
        const monthNames = ["January", "February", "March", "April", "May", "June", 
                          "July", "August", "September", "October", "November", "December"];
        currentMonthEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;
        
        // Get first day of month and total days in month
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        
        // Get days from previous month to show
        const daysFromPrevMonth = firstDay;
        const prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();
        
        // Get days from next month to show
        const totalDaysShown = Math.ceil((daysInMonth + daysFromPrevMonth) / 7) * 7;
        const daysFromNextMonth = totalDaysShown - (daysInMonth + daysFromPrevMonth);
        
        // Create calendar days
        for (let i = 0; i < totalDaysShown; i++) {
          const dayEl = document.createElement('div');
          dayEl.className = 'calendar-day';
          
          // Previous month days
          if (i < daysFromPrevMonth) {
            const day = prevMonthDays - (daysFromPrevMonth - 1 - i);
            dayEl.innerHTML = `<div class="calendar-day-number">${day}</div>`;
            dayEl.classList.add('empty');
          } 
          // Current month days
          else if (i < daysFromPrevMonth + daysInMonth) {
            const day = i - daysFromPrevMonth + 1;
            const dayDate = new Date(currentYear, currentMonth, day);
            
            dayEl.innerHTML = `<div class="calendar-day-number">${day}</div>`;
            
            // Highlight today
            if (day === currentDate.getDate() && 
                currentMonth === currentDate.getMonth() && 
                currentYear === currentDate.getFullYear()) {
              dayEl.classList.add('today');
            }
            
            // Add events for this day
            const dayEvents = events.filter(event => {
              const eventDate = new Date(event.date);
              return eventDate.getDate() === day && 
                     eventDate.getMonth() === currentMonth && 
                     eventDate.getFullYear() === currentYear;
            });
            
            dayEvents.forEach(event => {
              const eventEl = document.createElement('div');
              eventEl.className = 'calendar-event';
              eventEl.textContent = event.title;
              eventEl.addEventListener('click', (e) => {
                e.stopPropagation();
                viewEventDetails(event);
              });
              dayEl.appendChild(eventEl);
            });
          } 
          // Next month days
          else {
            const day = i - (daysFromPrevMonth + daysInMonth) + 1;
            dayEl.innerHTML = `<div class="calendar-day-number">${day}</div>`;
            dayEl.classList.add('empty');
          }
          
          calendarDaysEl.appendChild(dayEl);
        }
      }
      
      // Calendar Navigation
      prevMonthBtn.addEventListener('click', () => {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        renderCalendar();
      });
      
      nextMonthBtn.addEventListener('click', () => {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        renderCalendar();
      });
      
      todayBtn.addEventListener('click', () => {
        currentDate = new Date();
        currentMonth = currentDate.getMonth();
        currentYear = currentDate.getFullYear();
        renderCalendar();
      });
      
      // Edit Task
      function editTask(task) {
        isEditing = true;
        currentEditId = task.id;
        modalTitle.textContent = 'Edit Task';
        submitBtn.textContent = 'Update Task';
        
        document.getElementById('taskId').value = task.id;
        document.getElementById('taskTitle').value = task.title;
        document.getElementById('taskDescription').value = task.description || '';
        document.getElementById(`${task.priority}Priority`).checked = true;
        document.getElementById('dueDate').value = task.dueDate || '';
        document.getElementById('taskTeam').value = task.team || '';
        
        taskModal.classList.add('active');
      }
      
      // View Task Details
      function viewTaskDetails(task) {
        const dueDate = task.dueDate ? new Date(task.dueDate) : null;
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const isOverdue = dueDate && !task.completed && dueDate < today;
        
        const dueDateDisplay = dueDate ? 
          `<p><strong>Due Date:</strong> ${dueDate.toLocaleDateString()} ${isOverdue ? '<span style="color: var(--overdue-color)">(Overdue)</span>' : ''}</p>` : '';
        
        const descriptionDisplay = task.description ? 
          `<p><strong>Description:</strong><br>${task.description}</p>` : '';
        
        const status = task.completed ? 
          '<span style="color: var(--success)">Completed</span>' : 
          '<span style="color: var(--primary-600)">Pending</span>';
        
        const priorityColors = {
          critical: 'var(--priority-critical)',
          high: 'var(--priority-high)',
          medium: 'var(--priority-medium)',
          low: 'var(--priority-low)'
        };
        
        const teamDisplay = task.team ? 
          `<p><strong>Team:</strong> ${task.team}</p>` : '';
        
        const modalContent = `
          <div class="task-detail-modal">
            <h2>${task.title}</h2>
            <p><strong>Status:</strong> ${status}</p>
            <p><strong>Priority:</strong> <span style="color: ${priorityColors[task.priority]}">${task.priority}</span></p>
            ${teamDisplay}
            ${dueDateDisplay}
            ${descriptionDisplay}
            <p><strong>Created:</strong> ${new Date(task.createdAt).toLocaleString()}</p>
            <p><strong>Last Updated:</strong> ${new Date(task.updatedAt).toLocaleString()}</p>
            <div class="detail-actions">
              <button id="editDetailBtn" class="btn btn-primary">Edit Task</button>
              <button id="startFocusBtn" class="btn btn-secondary">Start Focus</button>
              <button id="closeDetailBtn" class="btn btn-secondary">Close</button>
            </div>
          </div>
        `;
        
        const detailModal = document.createElement('div');
        detailModal.className = 'modal active';
        detailModal.innerHTML = `
          <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
              <h3 class="modal-title">Task Details</h3>
              <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
              ${modalContent}
            </div>
          </div>
        `;
        
        document.body.appendChild(detailModal);
        
        // Add event listeners
        detailModal.querySelector('.modal-close').addEventListener('click', () => {
          detailModal.remove();
        });
        
        detailModal.querySelector('#closeDetailBtn').addEventListener('click', () => {
          detailModal.remove();
        });
        
        detailModal.querySelector('#editDetailBtn').addEventListener('click', () => {
          detailModal.remove();
          editTask(task);
        });
        
        detailModal.querySelector('#startFocusBtn').addEventListener('click', () => {
          detailModal.remove();
          startFocusSession(task);
        });
        
        window.addEventListener('click', (e) => {
          if (e.target === detailModal) {
            detailModal.remove();
          }
        });
      }
      
      // View Event Details
      function viewEventDetails(event) {
        const eventDate = new Date(event.date);
        
        const modalContent = `
          <div class="event-detail-modal">
            <h2>${event.title}</h2>
            <p><strong>Date:</strong> ${eventDate.toLocaleDateString()}</p>
            ${event.description ? `<p><strong>Description:</strong><br>${event.description}</p>` : ''}
            <div class="detail-actions">
              <button id="editEventDetailBtn" class="btn btn-primary">Edit Event</button>
              <button id="deleteEventDetailBtn" class="btn btn-secondary">Delete</button>
              <button id="closeEventDetailBtn" class="btn btn-secondary">Close</button>
            </div>
          </div>
        `;
        
        const detailModal = document.createElement('div');
        detailModal.className = 'modal active';
        detailModal.innerHTML = `
          <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
              <h3 class="modal-title">Event Details</h3>
              <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
              ${modalContent}
            </div>
          </div>
        `;
        
        document.body.appendChild(detailModal);
        
        // Add event listeners
        detailModal.querySelector('.modal-close').addEventListener('click', () => {
          detailModal.remove();
        });
        
        detailModal.querySelector('#closeEventDetailBtn').addEventListener('click', () => {
          detailModal.remove();
        });
        
        detailModal.querySelector('#editEventDetailBtn').addEventListener('click', () => {
          detailModal.remove();
          editEvent(event);
        });
        
        detailModal.querySelector('#deleteEventDetailBtn').addEventListener('click', () => {
          if (confirm('Are you sure you want to delete this event?')) {
            events = events.filter(e => e.id !== event.id);
            saveEvents();
            renderCalendar();
            addActivity(`Deleted event "${event.title}"`);
            showToast('Event deleted successfully!', 'success');
            detailModal.remove();
          }
        });
        
        window.addEventListener('click', (e) => {
          if (e.target === detailModal) {
            detailModal.remove();
          }
        });
      }
      
      // Edit Event
      function editEvent(event) {
        isEditingEvent = true;
        currentEditEventId = event.id;
        eventModalTitle.textContent = 'Edit Event';
        submitEventBtn.textContent = 'Update Event';
        
        document.getElementById('eventId').value = event.id;
        document.getElementById('eventTitle').value = event.title;
        document.getElementById('eventDate').value = event.date;
        document.getElementById('eventDescription').value = event.description || '';
        
        eventModal.classList.add('active');
      }
      
      // Focus Mode
      function startFocusSession(task) {
        focusTaskTitle.textContent = task.title;
        focusTimeLeft = 25 * 60; // 25 minutes
        isFocusPaused = false;
        updateFocusTimerDisplay();
        focusContainer.classList.add('active');
        
        focusInterval = setInterval(() => {
          if (!isFocusPaused) {
            focusTimeLeft--;
            updateFocusTimerDisplay();
            
            if (focusTimeLeft <= 0) {
              endFocusSession(true);
              // Automatically mark task as completed if checkbox is present
              const taskCheckbox = document.querySelector(`.task-item[data-id="${task.id}"] .task-checkbox`);
              if (taskCheckbox) {
                taskCheckbox.checked = true;
                taskCheckbox.dispatchEvent(new Event('change'));
              }
            }
          }
        }, 1000);
      }
      
      function updateFocusTimerDisplay() {
        const minutes = Math.floor(focusTimeLeft / 60);
        const seconds = focusTimeLeft % 60;
        focusTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }
      
      pauseFocusBtn.addEventListener('click', () => {
        isFocusPaused = !isFocusPaused;
        pauseFocusBtn.textContent = isFocusPaused ? 'Resume' : 'Pause';
      });
      
      endFocusBtn.addEventListener('click', () => {
        endFocusSession(false);
      });
      
      function endFocusSession(completed) {
        clearInterval(focusInterval);
        focusContainer.classList.remove('active');
        if (completed) {
          showToast('Focus session completed!', 'success');
        } else {
          showToast('Focus session ended', 'info');
        }
      }
      
      // AI Assistant
      function setupAIAssistant() {
        let conversationHistory = [];
        
        // Toggle AI assistant
        aiToggle.addEventListener('click', () => {
          aiAssistant.classList.toggle('active');
          if (aiAssistant.classList.contains('active')) {
            aiInput.focus();
          }
        });
        
        aiCloseBtn.addEventListener('click', () => {
          aiAssistant.classList.remove('active');
        });
        
        // Send message when button clicked or Enter pressed
        aiSendBtn.addEventListener('click', sendAIMessage);
        aiInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            sendAIMessage();
          }
        });
        
        function sendAIMessage() {
          const message = aiInput.value.trim();
          if (!message) return;
          
          addAIMessage(message, 'user');
          conversationHistory.push({ role: 'user', content: message });
          aiInput.value = '';
          
          // Show typing indicator
          const typingIndicator = document.createElement('div');
          typingIndicator.className = 'ai-typing';
          typingIndicator.innerHTML = `
            <div class="ai-typing-dot"></div>
            <div class="ai-typing-dot"></div>
            <div class="ai-typing-dot"></div>
          `;
          aiMessages.appendChild(typingIndicator);
          aiMessages.scrollTop = aiMessages.scrollHeight;
          
          // Simulate thinking time
          setTimeout(() => {
            // Remove typing indicator
            if (typingIndicator.parentNode) {
              typingIndicator.remove();
            }
            
            // Process message and generate response
            const response = generateAIResponse(message);
            addAIMessage(response, 'ai');
            conversationHistory.push({ role: 'ai', content: response });
          }, 1000 + Math.random() * 2000); // Random delay between 1-3 seconds
        }
        
        function addAIMessage(message, sender = 'ai') {
          const now = new Date();
          const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          
          const messageDiv = document.createElement('div');
          messageDiv.className = `ai-message ${sender}`;
          messageDiv.innerHTML = `
            <div class="ai-message-content">${message}</div>
            <div class="ai-message-time">${timeString}</div>
          `;
          
          aiMessages.appendChild(messageDiv);
          aiMessages.scrollTop = aiMessages.scrollHeight;
        }
        
        function generateAIResponse(message) {
          const lowerMessage = message.toLowerCase();
          
          // Greetings
          if (lowerMessage.includes('hi') || lowerMessage.includes('hello') || lowerMessage.includes('hey')) {
            return "Hello! How can I assist you with your tasks today?";
          }
          
          // Help command
          if (lowerMessage.includes('help') || lowerMessage === '?') {
            return `I can help you with:
            - Task management (create, complete, delete tasks)
            - Calendar events
            - Focus mode
            - Reports and statistics
            - General questions about TaskFlow
            
            Try asking things like:
            - "What tasks do I have today?"
            - "Create a new task called 'Finish report'"
            - "How many tasks are completed?"`;
          }
          
          // Task queries
          if (lowerMessage.includes('task') || lowerMessage.includes('tasks')) {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const pendingTasks = totalTasks - completedTasks;
            
            if (lowerMessage.includes('how many')) {
              return `You have ${totalTasks} tasks in total:
              - ${completedTasks} completed
              - ${pendingTasks} pending`;
            }
            
            if (lowerMessage.includes('today')) {
              const todaysTasks = getTodaysTasks();
              if (todaysTasks.length === 0) {
                return "You have no tasks due today. Great job!";
              }
              
              let response = `You have ${todaysTasks.length} tasks due today:\n`;
              todaysTasks.forEach((task, index) => {
                response += `${index + 1}. ${task.title} (${task.priority} priority)\n`;
              });
              return response;
            }
            
            if (lowerMessage.includes('create') || lowerMessage.includes('add')) {
              const taskTitleMatch = message.match(/"([^"]+)"/) || message.match(/'([^']+)'/);
              if (taskTitleMatch) {
                const taskTitle = taskTitleMatch[1];
                const newTask = {
                  id: Date.now(),
                  title: taskTitle,
                  description: "",
                  priority: "medium",
                  dueDate: "",
                  team: "",
                  completed: false,
                  createdAt: new Date().toISOString(),
                  updatedAt: new Date().toISOString()
                };
                
                tasks.unshift(newTask);
                saveTasks();
                renderTasks();
                updateStats();
                addActivity(`Created new task "${taskTitle}" via AI`);
                
                return `I've created a new task: "${taskTitle}". Would you like me to set a due date or priority?`;
              } else {
                return "Please provide a task title in quotes, like: \"Finish project\"";
              }
            }
            
            return `You have ${totalTasks} tasks in total (${completedTasks} completed, ${pendingTasks} pending). 
            Would you like me to list them or help with something specific?`;
          }
          
          // Calendar queries
          if (lowerMessage.includes('calendar') || lowerMessage.includes('event') || lowerMessage.includes('schedule')) {
            if (lowerMessage.includes('upcoming')) {
              const upcomingEvents = events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate >= new Date();
              });
              
              if (upcomingEvents.length === 0) {
                return "You have no upcoming events scheduled.";
              }
              
              let response = "Here are your upcoming events:\n";
              upcomingEvents.slice(0, 5).forEach(event => {
                const eventDate = new Date(event.date);
                response += `- ${event.title} on ${eventDate.toLocaleDateString()}\n`;
              });
              return response;
            }
            
            return "I can help with calendar events. Try asking about 'upcoming events' or 'create new event'.";
          }
          
          // Focus mode
          if (lowerMessage.includes('focus') || lowerMessage.includes('pomodoro')) {
            return "I can start a focus session for you. Just select a task and click the focus button, or tell me which task you'd like to focus on.";
          }
          
          // Default response
          const randomResponses = [
            "I'm not sure I understand. Could you rephrase that?",
            "How can I assist you with your tasks?",
            "Would you like help with your tasks, calendar, or something else?",
            "I'm here to help you manage your tasks more effectively. What would you like to know?"
          ];
          
          return randomResponses[Math.floor(Math.random() * randomResponses.length)];
        }
        
        function getTodaysTasks() {
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          
          return tasks.filter(task => {
            if (!task.dueDate) return false;
            const dueDate = new Date(task.dueDate);
            dueDate.setHours(0, 0, 0, 0);
            return dueDate.getTime() === today.getTime();
          });
        }
        
        // Add quick suggestions
        function addQuickSuggestions() {
          const suggestions = [
            "What tasks do I have today?",
            "Create a new task",
            "Show upcoming events",
            "How many tasks are completed?"
          ];
          
          const suggestionsContainer = document.createElement('div');
          suggestionsContainer.className = 'ai-suggestions';
          
          suggestions.forEach(suggestion => {
            const suggestionEl = document.createElement('div');
            suggestionEl.className = 'ai-suggestion';
            suggestionEl.textContent = suggestion;
            suggestionEl.addEventListener('click', () => {
              aiInput.value = suggestion;
              aiInput.focus();
            });
            suggestionsContainer.appendChild(suggestionEl);
          });
          
          aiMessages.appendChild(suggestionsContainer);
          aiMessages.scrollTop = aiMessages.scrollHeight;
        }
        
        // Initialize with quick suggestions
        addQuickSuggestions();
      }
      
      // Activity Feed
      function addActivity(message) {
        const activityItem = document.createElement('div');
        activityItem.className = 'activity-item';
        activityItem.innerHTML = `
          <div class="activity-icon">
            <i class="fas fa-check"></i>
          </div>
          <div class="activity-content">
            <div>${message}</div>
            <div class="activity-time">Just now</div>
          </div>
        `;
        
        activityFeed.insertBefore(activityItem, activityFeed.firstChild);
        
        // Limit to 5 activities
        if (activityFeed.children.length > 5) {
          activityFeed.removeChild(activityFeed.lastChild);
        }
      }
      
      // Initialize with some sample activities
      function initActivityFeed() {
        const sampleActivities = [
          'Welcome to TaskFlow Pro!',
          'Try creating your first task',
          'Explore the dashboard features'
        ];
        
        sampleActivities.forEach(activity => {
          addActivity(activity);
        });
      }
      
      // Update Stats and Chart
      function updateStats() {
        const completedTasks = tasks.filter(task => task.completed).length;
        const pendingTasks = tasks.length - completedTasks;
        const criticalCount = tasks.filter(task => task.priority === 'critical').length;
        const highCount = tasks.filter(task => task.priority === 'high').length;
        const mediumCount = tasks.filter(task => task.priority === 'medium').length;
        const lowCount = tasks.filter(task => task.priority === 'low').length;
        
        // Count overdue tasks
        const overdueCount = tasks.filter(task => {
          return task.dueDate && !task.completed && new Date(task.dueDate) < new Date();
        }).length;
        
        // Update chart
        progressChart.data.datasets[0].data = [completedTasks, pendingTasks];
        progressChart.update();
        
        // Update stats
        document.getElementById('criticalCount').textContent = criticalCount;
        document.getElementById('highCount').textContent = highCount;
        document.getElementById('mediumCount').textContent = mediumCount;
        document.getElementById('lowCount').textContent = lowCount;
        document.getElementById('overdueCount').textContent = overdueCount;
      }
      
      // Show Toast Notification
      function showToast(message, type = 'success') {
        toastMessage.textContent = message;
        toast.className = 'toast';
        toast.classList.add(type);
        toast.classList.add('show');
        
        // Set icon based on type
        const icon = toast.querySelector('.toast-icon');
        if (type === 'error') {
          icon.className = 'fas fa-exclamation-circle toast-icon';
        } else if (type === 'warning') {
          icon.className = 'fas fa-exclamation-triangle toast-icon';
        } else {
          icon.className = 'fas fa-check-circle toast-icon';
        }
        
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }
      
      // Settings Modals
      const profileModal = document.getElementById('profileModal');
      const passwordModal = document.getElementById('passwordModal');
      const notificationsModal = document.getElementById('notificationsModal');
      const defaultViewModal = document.getElementById('defaultViewModal');
      const teamMembersModal = document.getElementById('teamMembersModal');
      const teamRolesModal = document.getElementById('teamRolesModal');
      const taskDefaultsModal = document.getElementById('taskDefaultsModal');

      // Initialize settings from localStorage
      let userSettings = JSON.parse(localStorage.getItem('userSettings')) || {
        profile: {
          name: 'User Name',
          email: 'user@example.com',
          avatar: ''
        },
        notifications: {
          email: 'all',
          push: true
        },
        defaultView: 'dashboard',
        taskDefaults: {
          priority: 'high',
          dueDays: 3
        }
      };

      // Load settings when page loads
      function loadSettings() {
        // Profile
        document.getElementById('profileName').value = userSettings.profile.name;
        document.getElementById('profileEmail').value = userSettings.profile.email;
        document.getElementById('profileAvatar').value = userSettings.profile.avatar;
        
        // Notifications
        document.querySelector(`input[name="emailNotifications"][value="${userSettings.notifications.email}"]`).checked = true;
        document.getElementById('pushNotifications').checked = userSettings.notifications.push;
        
        // Default View
        document.getElementById('defaultViewSelect').value = userSettings.defaultView;
        
        // Task Defaults
        document.getElementById(`${userSettings.taskDefaults.priority}Priority`).checked = true;
        document.getElementById('defaultDueDays').value = userSettings.taskDefaults.dueDays;
      }

      // Save settings to localStorage
      function saveSettings() {
        localStorage.setItem('userSettings', JSON.stringify(userSettings));
      }

      // Profile Form
      document.getElementById('profileForm').addEventListener('submit', (e) => {
        e.preventDefault();
        userSettings.profile = {
          name: document.getElementById('profileName').value,
          email: document.getElementById('profileEmail').value,
          avatar: document.getElementById('profileAvatar').value
        };
        saveSettings();
        showToast('Profile updated successfully!', 'success');
        profileModal.classList.remove('active');
      });

      // Password Form
      document.getElementById('passwordForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (newPassword !== confirmPassword) {
          showToast('Passwords do not match!', 'error');
          return;
        }
        
        // In a real app, you would verify current password and update it
        showToast('Password changed successfully!', 'success');
        passwordModal.classList.remove('active');
        document.getElementById('passwordForm').reset();
      });

      // Notifications Form
      document.getElementById('notificationsForm').addEventListener('submit', (e) => {
        e.preventDefault();
        userSettings.notifications = {
          email: document.querySelector('input[name="emailNotifications"]:checked').value,
          push: document.getElementById('pushNotifications').checked
        };
        saveSettings();
        showToast('Notification preferences saved!', 'success');
        notificationsModal.classList.remove('active');
      });

      // Default View Form
      document.getElementById('defaultViewForm').addEventListener('submit', (e) => {
        e.preventDefault();
        userSettings.defaultView = document.getElementById('defaultViewSelect').value;
        saveSettings();
        showToast(`Default view set to ${userSettings.defaultView}`, 'success');
        defaultViewModal.classList.remove('active');
      });

      // Team Members Form
      document.getElementById('teamMembersForm').addEventListener('submit', (e) => {
        e.preventDefault();
        showToast('Team members updated!', 'success');
        teamMembersModal.classList.remove('active');
      });

      // Team Roles Form
      document.getElementById('teamRolesForm').addEventListener('submit', (e) => {
        e.preventDefault();
        showToast('Team roles updated!', 'success');
        teamRolesModal.classList.remove('active');
      });

      // Task Defaults Form
      document.getElementById('taskDefaultsForm').addEventListener('submit', (e) => {
        e.preventDefault();
        userSettings.taskDefaults = {
          priority: document.querySelector('input[name="defaultPriority"]:checked').value,
          dueDays: document.getElementById('defaultDueDays').value
        };
        saveSettings();
        showToast('Task defaults updated!', 'success');
        taskDefaultsModal.classList.remove('active');
      });

      // Button Event Listeners
      document.getElementById('editProfileBtn').addEventListener('click', () => {
        loadSettings();
        profileModal.classList.add('active');
      });

      document.getElementById('changePasswordBtn').addEventListener('click', () => {
        passwordModal.classList.add('active');
      });

      document.getElementById('notificationsBtn').addEventListener('click', () => {
        loadSettings();
        notificationsModal.classList.add('active');
      });

      document.getElementById('defaultViewBtn').addEventListener('click', () => {
        loadSettings();
        defaultViewModal.classList.add('active');
      });

      document.getElementById('teamMembersBtn').addEventListener('click', () => {
        teamMembersModal.classList.add('active');
      });

      document.getElementById('teamRolesBtn').addEventListener('click', () => {
        teamRolesModal.classList.add('active');
      });

      document.getElementById('taskDefaultsBtn').addEventListener('click', () => {
        loadSettings();
        taskDefaultsModal.classList.add('active');
      });

      // Initialize settings when page loads
      document.addEventListener('DOMContentLoaded', loadSettings);
      
      // Initial render
      initTheme();
      initActivityFeed();
      renderTasks();
      updateStats();
      renderCalendar();
      setupAIAssistant();

      // Activate first team by default
      if (teamNavItems.length > 0) {
        teamNavItems[0].click();
      }
    });
  </script>
</body>
</html>